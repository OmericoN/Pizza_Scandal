{% extends "layout_v2.html" %}

{% block title %}Ingredient Management - Pizza Scandal{% endblock %}

{% block content_wrapper %}
<div class="dashboard-container">
    <!-- Header -->
    <div class="dashboard-header">
        <div class="container">
            <div class="header-content">
                <div>
                    <h1 class="text-h1">Ingredient Management</h1>
                    <p class="text-body-small">View and search all ingredients</p>
                </div>
                <div class="header-actions">
                    <a href="{{ url_for('admin.dashboard') }}" class="btn btn-secondary">Back to Dashboard</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Search Bar -->
    <div class="container">
        <div class="search-container">
            <input type="text" id="ingredientSearch" class="search-input" placeholder="Search ingredients by name...">
            <div class="search-stats">
                <span id="ingredientCount">{{ ingredients|length }}</span> ingredients found
            </div>
        </div>
    </div>

    <!-- Ingredients Table -->
    <div class="container">
        <div class="table-container">
            <table class="ingredient-table">
                <thead>
                    <tr>
                        <th class="id-column">ID</th>
                        <th class="name-column">Name</th>
                        <th class="cost-column">Cost</th>
                        <th class="vegetarian-column">Vegetarian</th>
                        <th class="usage-column">Used In</th>
                    </tr>
                </thead>
                <tbody>
                    {% for ingredient in ingredients %}
                    <tr class="ingredient-row">
                        <td class="id-cell">{{ ingredient.ingredient_id }}</td>
                        <td class="name-cell">
                            <div class="ingredient-name">{{ ingredient.name }}</div>
                        </td>
                        <td class="cost-cell">
                            <div class="cost-display">
                                <span class="cost-amount">${{ "%.2f"|format(ingredient.cost) }}</span>
                            </div>
                        </td>
                        <td class="vegetarian-cell">
                            {% if ingredient.vegetarian %}
                                <span class="vegetarian-badge">ðŸŒ± Yes</span>
                            {% else %}
                                <span class="non-vegetarian-badge">ðŸ¥© No</span>
                            {% endif %}
                        </td>
                        <td class="usage-cell">
                            {% if ingredient.pizzas %}
                                <div class="pizza-usage">
                                    <span class="usage-count">{{ ingredient.pizzas|length }} pizza(s)</span>
                                    <div class="pizza-list">
                                        {% for pizza in ingredient.pizzas[:2] %}
                                            <span class="pizza-tag">{{ pizza.name }}</span>
                                        {% endfor %}
                                        {% if ingredient.pizzas|length > 2 %}
                                            <span class="more-pizzas">+{{ ingredient.pizzas|length - 2 }} more</span>
                                        {% endif %}
                                    </div>
                                </div>
                            {% else %}
                                <span class="no-usage">Not used</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="5" class="no-data">No ingredients found</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- Simple Stats -->
    <div class="container">
        <div class="stats-container">
            <div class="stat-card">
                <div class="stat-number">{{ ingredients|length }}</div>
                <div class="stat-label">Total Ingredients</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">{{ ingredients|selectattr('vegetarian')|list|length }}</div>
                <div class="stat-label">Vegetarian</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">{{ (ingredients|length) - (ingredients|selectattr('vegetarian')|list|length) }}</div>
                <div class="stat-label">Non-Vegetarian</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">${{ "%.2f"|format(ingredients|sum(attribute='cost')) }}</div>
                <div class="stat-label">Total Value</div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
.dashboard-container {
    min-height: 100vh;
    background: var(--background);
}

.dashboard-header {
    background: var(--card-background);
    border-bottom: 1px solid var(--border);
    padding: var(--space-lg) 0;
    margin-bottom: var(--space-xl);
}

.header-content {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.header-actions {
    display: flex;
    gap: var(--space-md);
}

/* Search Container */
.search-container {
    background: var(--card-background);
    border-radius: var(--radius-lg);
    padding: var(--space-lg);
    margin-bottom: var(--space-lg);
    box-shadow: var(--shadow-subtle);
    border: 1px solid var(--border);
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: var(--space-md);
}

.search-input {
    flex: 1;
    padding: 12px 16px;
    border: 1px solid var(--border);
    border-radius: var(--radius-md);
    font-size: 16px;
    background: var(--background);
}

.search-input:focus {
    outline: none;
    border-color: var(--brand);
    box-shadow: 0 0 0 3px rgba(210, 105, 30, 0.1);
}

.search-stats {
    color: var(--text-secondary);
    font-size: 14px;
    font-weight: 500;
}

/* Table Container */
.table-container {
    background: var(--card-background);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-subtle);
    border: 1px solid var(--border);
    overflow: hidden;
    margin-bottom: var(--space-xl);
}

/* Table Styles */
.ingredient-table {
    width: 100%;
    border-collapse: collapse;
    font-family: var(--font-family);
}

.ingredient-table thead {
    background: #f8f9fa;
}

.ingredient-table th {
    padding: 16px 12px;
    text-align: left;
    font-weight: 600;
    color: var(--text-primary);
    font-size: 16px;
    border-bottom: 2px solid var(--border);
}

.ingredient-table td {
    padding: 16px 12px;
    border-bottom: 1px solid #e9ecef;
    color: var(--text-primary);
    vertical-align: top;
}

.ingredient-row:hover {
    background-color: #f8f9fa;
}

/* Column Widths */
.id-column { width: 80px; }
.name-column { width: 250px; }
.cost-column { width: 120px; }
.vegetarian-column { width: 120px; }
.usage-column { width: 300px; }

/* Cell Styling */
.id-cell {
    font-weight: 500;
    color: var(--text-secondary);
}

.ingredient-name {
    font-weight: 600;
    color: var(--text-primary);
    font-size: 16px;
}

.cost-display {
    text-align: center;
}

.cost-amount {
    font-weight: 700;
    color: var(--brand);
    font-size: 16px;
}

.vegetarian-badge {
    background: rgba(39, 174, 96, 0.1);
    color: var(--success);
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 12px;
    font-weight: 500;
    border: 1px solid rgba(39, 174, 96, 0.2);
}

.non-vegetarian-badge {
    background: rgba(231, 76, 60, 0.1);
    color: var(--danger);
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 12px;
    font-weight: 500;
    border: 1px solid rgba(231, 76, 60, 0.2);
}

.pizza-usage {
    display: flex;
    flex-direction: column;
    gap: 4px;
}

.usage-count {
    font-weight: 600;
    color: var(--text-primary);
    font-size: 14px;
}

.pizza-list {
    display: flex;
    flex-wrap: wrap;
    gap: 4px;
}

.pizza-tag {
    background: var(--brand);
    color: white;
    padding: 2px 6px;
    border-radius: 4px;
    font-size: 11px;
    font-weight: 500;
}

.more-pizzas {
    color: var(--text-muted);
    font-size: 11px;
    font-style: italic;
}

.no-usage {
    color: var(--text-muted);
    font-style: italic;
}

/* Summary Stats */
.stats-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: var(--space-lg);
}

.stat-card {
    background: var(--card-background);
    padding: var(--space-lg);
    border-radius: var(--radius-lg);
    text-align: center;
    box-shadow: var(--shadow-subtle);
    border: 1px solid var(--border);
}

.stat-number {
    font-size: 32px;
    font-weight: 700;
    color: var(--brand);
    margin-bottom: var(--space-sm);
}

.stat-card .stat-label {
    color: var(--text-secondary);
    text-transform: uppercase;
    font-size: 12px;
    letter-spacing: 0.5px;
}

/* Hidden rows for search */
.ingredient-row.hidden {
    display: none;
}

.no-data {
    text-align: center;
    color: var(--text-muted);
    font-style: italic;
    padding: 40px 20px;
}

/* Responsive Design */
@media (max-width: 768px) {
    .header-content {
        flex-direction: column;
        gap: var(--space-md);
        text-align: center;
    }
    
    .search-container {
        flex-direction: column;
        align-items: stretch;
        gap: var(--space-sm);
    }
    
    .ingredient-table {
        font-size: 12px;
    }
    
    .ingredient-table th,
    .ingredient-table td {
        padding: 8px 6px;
    }
    
    .pizza-list {
        flex-direction: column;
    }
    
    .stats-container {
        grid-template-columns: repeat(2, 1fr);
    }
}
</style>
{% endblock %}

{% block extra_js %}
<script>
// Simple search functionality
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('ingredientSearch');
    const ingredientRows = document.querySelectorAll('.ingredient-row');
    const ingredientCount = document.getElementById('ingredientCount');

    searchInput.addEventListener('input', function() {
        const searchTerm = this.value.toLowerCase();
        let visibleCount = 0;

        ingredientRows.forEach(row => {
            const name = row.querySelector('.ingredient-name').textContent.toLowerCase();
            
            if (name.includes(searchTerm)) {
                row.classList.remove('hidden');
                visibleCount++;
            } else {
                row.classList.add('hidden');
            }
        });

        ingredientCount.textContent = visibleCount;
    });
});
</script>
{% endblock %}